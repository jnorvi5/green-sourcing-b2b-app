# ============================================
# GREENCHAINZ AZURE PRODUCTION CONFIGURATION
# ============================================
#
# This file shows the environment variables needed for Azure Container Apps.
# 
# ⚠️  DO NOT COMMIT THIS FILE WITH REAL VALUES!
#
# SECRETS: Set these in Azure Key Vault, NOT here.
# CONFIG:  Set these in Container App environment variables.
#
# See docs/AZURE_SECRETS_AND_CONFIG.md for complete setup guide.
#
# ============================================

# ============================================
# CORE SETTINGS (Container App Environment Variables)
# ============================================

NODE_ENV=production
PORT=3001
LOG_LEVEL=info

# ============================================
# FRONTEND/BACKEND URLs (Container App Environment Variables)
# ============================================

FRONTEND_URL=https://greenchainz.com
BACKEND_URL=https://api.greenchainz.com
COOKIE_DOMAIN=.greenchainz.com

# ============================================
# SECRETS (Azure Key Vault - DO NOT SET HERE)
# ============================================
# These are referenced from Key Vault, not set directly.
# In Azure Container Apps, use Key Vault references:
#
# JWT_SECRET:       secretRef → keyvault → jwt-secret
# SESSION_SECRET:   secretRef → keyvault → session-secret
# COOKIE_SECRET:    secretRef → keyvault → cookie-secret
# DB_PASSWORD:      secretRef → keyvault → postgres-password
# REDIS_PASSWORD:   secretRef → keyvault → redis-password
# AZURE_CLIENT_SECRET: secretRef → keyvault → azure-client-secret
#
# See azure/setup-secrets.sh for Key Vault setup commands.

# ============================================
# AZURE KEY VAULT (Container App Environment Variables)
# ============================================

AZURE_KEY_VAULT_URL=https://greenchainz-vault.vault.azure.net/
AZURE_USE_MANAGED_IDENTITY=true

# ============================================
# POSTGRESQL DATABASE (Container App Environment Variables)
# ============================================
# Password comes from Key Vault reference

POSTGRES_HOST=greenchainz-db.postgres.database.azure.com
POSTGRES_PORT=5432
DB_USER=greenchainz_app
DB_NAME=greenchainz_prod
POSTGRES_SSL=true

# Alternative: Full connection string (if using)
# DATABASE_URL=postgresql://user:password@host:5432/db?sslmode=require

# Connection pool (tune based on your instance size)
PGPOOL_MAX=20
PGPOOL_MIN=5
PGPOOL_IDLE=30000
PGPOOL_CONNECTION_TIMEOUT=10000
PGPOOL_STATEMENT_TIMEOUT=60000

# ============================================
# AZURE AD AUTHENTICATION (Container App Environment Variables)
# ============================================
# Client secret comes from Key Vault reference

AZURE_TENANT_ID=greenchainz2025.onmicrosoft.com
AZURE_CLIENT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# ============================================
# AZURE REDIS CACHE (Container App Environment Variables)
# ============================================
# Password comes from Key Vault reference

REDIS_HOST=greenchainz.redis.cache.windows.net
REDIS_PORT=6380
REDIS_SSL=true

# ============================================
# AZURE BLOB STORAGE (Container App Environment Variables)
# ============================================
# Uses managed identity - no connection string needed

AZURE_STORAGE_ACCOUNT_NAME=greenchainzstorage
AZURE_STORAGE_CONTAINER_NAME=greenchainz-uploads

# ============================================
# AZURE AI SERVICES (Container App Environment Variables)
# ============================================
# API key comes from Key Vault reference

AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT=https://greenchainz-ai.cognitiveservices.azure.com/
AZURE_OPENAI_ENDPOINT=https://greenchainz-openai.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-10-21
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o

# ============================================
# AZURE MONITORING (Container App Environment Variables)
# ============================================
# Connection string from Key Vault reference (contains key)

# APPLICATIONINSIGHTS_CONNECTION_STRING via Key Vault

# ============================================
# EMAIL CONFIGURATION (Container App Environment Variables)
# ============================================
# Password comes from Key Vault reference

NOTIFICATIONS_ENABLED=true
SMTP_HOST=smtp.zoho.com
SMTP_PORT=465
SMTP_USER=noreply@greenchainz.com
SMTP_FROM_EMAIL=noreply@greenchainz.com
SMTP_FROM_NAME=GreenChainz
ADMIN_EMAIL=admin@greenchainz.com

# ============================================
# FEATURE FLAGS (Container App Environment Variables)
# ============================================

FEATURE_AZURE_MONITORING=true
FEATURE_REDIS_CACHING=true
FEATURE_AI_DOCUMENT_ANALYSIS=true

# ============================================
# KEY VAULT SECRET NAMES REFERENCE
# ============================================
# Use these names when storing secrets in Key Vault:
#
# jwt-secret              → JWT_SECRET
# session-secret          → SESSION_SECRET
# cookie-secret           → COOKIE_SECRET
# postgres-password       → DB_PASSWORD
# redis-password          → REDIS_PASSWORD
# azure-client-secret     → AZURE_CLIENT_SECRET
# document-intel-key      → AZURE_DOCUMENT_INTELLIGENCE_KEY
# openai-key              → AZURE_OPENAI_KEY
# smtp-password           → SMTP_PASS
# appinsights-connection  → APPLICATIONINSIGHTS_CONNECTION_STRING
# stripe-secret-key       → STRIPE_SECRET_KEY
# stripe-webhook-secret   → STRIPE_WEBHOOK_SECRET
# intercom-token          → INTERCOM_ACCESS_TOKEN
# internal-api-key        → INTERNAL_API_KEY

# ============================================
# CONTAINER APP SECRETS CONFIGURATION
# ============================================
# In Azure Portal → Container App → Secrets, add:
#
# Name                    | Source      | Key Vault Secret URI
# ----------------------- | ----------- | ------------------------------------
# jwt-secret              | Key Vault   | https://vault.../secrets/jwt-secret
# session-secret          | Key Vault   | https://vault.../secrets/session-secret
# cookie-secret           | Key Vault   | https://vault.../secrets/cookie-secret
# postgres-password       | Key Vault   | https://vault.../secrets/postgres-password
# redis-password          | Key Vault   | https://vault.../secrets/redis-password
# azure-client-secret     | Key Vault   | https://vault.../secrets/azure-client-secret
#
# Then in Environment Variables, reference them:
#
# Name            | Value
# --------------- | -----------------
# JWT_SECRET      | secretref:jwt-secret
# SESSION_SECRET  | secretref:session-secret
# etc.
