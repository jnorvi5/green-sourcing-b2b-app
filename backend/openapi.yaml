openapi: 3.0.3
info:
  title: GreenChainz API
  version: 0.1.0
  description: |
    Early-stage API for suppliers, certifications, RFQs, scoring, and provider sync.
    Includes authentication, RFQ workflow, verification scoring, and FSC mock integration.
servers:
  - url: http://localhost:3001
paths:
  /api/v1/suppliers:
    post:
      summary: Create a supplier (company + supplier + profile)
      operationId: createSupplier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [companyName, address]
              properties:
                companyName:
                  type: string
                address:
                  type: string
                description:
                  type: string
                esgSummary:
                  type: string
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateSupplierResponse'
    get:
      summary: List all suppliers with basic info
      operationId: listSuppliers
      responses:
        '200':
          description: List of suppliers
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }
                  suppliers:
                    type: array
                    items:
                      $ref: '#/components/schemas/SupplierListItem'
  /api/v1/suppliers/search:
    get:
      summary: Search suppliers by certification and/or location
      operationId: searchSuppliers
      parameters:
        - in: query
          name: certification
          schema: { type: string }
        - in: query
          name: location
          schema: { type: string }
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }
                  filters:
                    type: object
                    properties:
                      certification: { type: string, nullable: true }
                      location: { type: string, nullable: true }
                  suppliers:
                    type: array
                    items:
                      $ref: '#/components/schemas/SupplierSearchResult'
  /api/v1/suppliers/{companyId}/profile:
    get:
      summary: Get a supplier profile by CompanyID
      operationId: getSupplierProfile
      parameters:
        - in: path
          name: companyId
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Supplier profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierProfile'
        '404':
          description: Not found
  /api/v1/suppliers/{companyId}/certifications:
    post:
      summary: Add a certification to a supplier (by CompanyID)
      operationId: addCertification
      parameters:
        - in: path
          name: companyId
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [certificationName, issuingBody]
              properties:
                certificationName: { type: string }
                issuingBody: { type: string }
                issuedDate: { type: string, format: date, nullable: true }
                expiryDate: { type: string, format: date, nullable: true }
      responses:
        '201':
          description: Certification added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  certificationId: { type: integer }
  /:
    get:
      summary: Health check
      operationId: rootHealth
      responses:
        '200':
          description: Health JSON
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /api/v1/auth/register:
    post:
      summary: Register a new user
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
                firstName: { type: string }
                lastName: { type: string }
                role: { type: string, enum: [Admin, Buyer, Supplier], nullable: true }
      responses:
        '201':
          description: User created
  /api/v1/auth/login:
    post:
      summary: Login user and return JWT
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200': { description: Auth success }
  /api/v1/buyers:
    post:
      summary: Create or update buyer profile for authenticated Buyer user
      operationId: createBuyerProfile
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                jobTitle: { type: string }
                projectTypes: { type: array, items: { type: string } }
                preferredContactMethod: { type: string }
      responses:
        '201': { description: Buyer profile created }
  /api/v1/rfqs:
    post:
      summary: Create RFQ (Buyer â†’ Supplier)
      operationId: createRFQ
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [supplierId, message]
              properties:
                supplierId: { type: integer }
                productId: { type: integer, nullable: true }
                projectName: { type: string, nullable: true }
                message: { type: string }
                quantityNeeded: { type: integer, nullable: true }
                unit: { type: string, nullable: true }
                budgetRange: { type: string, nullable: true }
                deadlineDate: { type: string, format: date, nullable: true }
      responses:
        '201': { description: RFQ created }
  /api/v1/suppliers/{supplierId}/rfqs:
    get:
      summary: List RFQs sent to a supplier
      operationId: listSupplierRFQs
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: supplierId
          required: true
          schema: { type: integer }
        - in: query
          name: status
          schema: { type: string }
      responses:
        '200': { description: RFQ list }
  /api/v1/rfqs/{rfqId}/respond:
    post:
      summary: Supplier responds to an RFQ
      operationId: respondRFQ
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: rfqId
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [quotedPrice]
              properties:
                quotedPrice: { type: number }
                leadTimeDays: { type: integer }
                message: { type: string }
                attachmentURLs: { type: array, items: { type: string } }
      responses:
        '201': { description: Response created }
  /api/v1/buyers/rfqs:
    get:
      summary: List RFQs created by authenticated buyer
      operationId: listBuyerRFQs
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: RFQ list }
  /api/v1/rfqs/{rfqId}/responses:
    get:
      summary: List responses for an RFQ (buyer or admin)
      operationId: listRFQResponses
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: rfqId
          required: true
          schema: { type: integer }
      responses:
        '200': { description: RFQ responses }
  /api/v1/rfqs/{rfqId}/responses/{responseId}/status:
    post:
      summary: Accept or decline an RFQ response
      operationId: updateRFQResponseStatus
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: rfqId
          required: true
          schema: { type: integer }
        - in: path
          name: responseId
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action]
              properties:
                action: { type: string, enum: [accept, decline] }
      responses:
        '200': { description: Status updated }
  /api/v1/suppliers/{id}/score:
    get:
      summary: Get live or persisted verification score for a supplier
      operationId: getSupplierScore
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Supplier score }
  /api/v1/metrics:
    get:
      summary: Platform metrics and aggregated supplier scores
      operationId: getMetrics
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Metrics }
  /api/v1/admin/verification/recompute:
    post:
      summary: Recompute and persist verification scores (Admin)
      operationId: recomputeVerificationScores
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Scores recomputed }
  /api/v1/suppliers/{id}/certifications:
    get:
      summary: Unified certifications (internal + FSC) for supplier
      operationId: getUnifiedCertifications
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Unified certification list }
  /api/v1/admin/providers:
    get:
      summary: List provider adapters
      operationId: listProviders
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Provider list }
  /api/v1/admin/providers/sync/fsc:
    post:
      summary: Trigger FSC mock provider sync
      operationId: syncFSCProvider
      security: [{ bearerAuth: [] }]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                status: { type: string }
                country: { type: string }
      responses:
        '200': { description: Sync results }
  /api/v1/admin/notifications:
    get:
      summary: Get notification log with filtering (Admin)
      operationId: getNotifications
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [sent, failed, skipped]
          description: Filter by notification status
        - in: query
          name: type
          schema:
            type: string
          description: Filter by notification type (e.g., rfq_created)
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
          description: Results per page
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
          description: Pagination offset
      responses:
        '200':
          description: Notification history
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  limit: { type: integer }
                  offset: { type: integer }
                  notifications:
                    type: array
                    items:
                      type: object
                      properties:
                        notificationid: { type: string }
                        notificationtype: { type: string }
                        recipient: { type: string }
                        subject: { type: string }
                        status: { type: string }
                        errormessage: { type: string, nullable: true }
                        createdat: { type: string, format: date-time }
  /api/v1/admin/notifications/test:
    post:
      summary: Send test email to validate SMTP configuration (Admin)
      operationId: testEmail
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [to]
              properties:
                to:
                  type: string
                  format: email
                  description: Recipient email address
      responses:
        '200':
          description: Test email attempted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  result:
                    type: object
                    properties:
                      sent: { type: boolean }
                      reason: { type: string, nullable: true }
                      messageId: { type: string, nullable: true }
                      error: { type: string, nullable: true }
components:
  schemas:
    CreateSupplierResponse:
      type: object
      properties:
        message: { type: string }
        supplierId: { type: integer }
        companyId: { type: integer }
        supplierRecordId: { type: integer }
    SupplierListItem:
      type: object
      properties:
        companyid: { type: integer }
        companyname: { type: string }
        address: { type: string }
        description: { type: string, nullable: true }
        esg_summary: { type: string, nullable: true }
        certification_count: { type: integer }
        createdat: { type: string, format: date-time }
    SupplierSearchResult:
      type: object
      properties:
        companyid: { type: integer }
        companyname: { type: string }
        address: { type: string }
        description: { type: string, nullable: true }
        esg_summary: { type: string, nullable: true }
        certifications:
          type: array
          items:
            type: object
            properties:
              name: { type: string }
              certifyingBody: { type: string }
              issueDate: { type: string, format: date, nullable: true }
              expiryDate: { type: string, format: date, nullable: true }
              status: { type: string, nullable: true }
    SupplierProfile:
      type: object
      properties:
        companyname: { type: string }
        address: { type: string }
        description: { type: string, nullable: true }
        esg_summary: { type: string, nullable: true }
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
